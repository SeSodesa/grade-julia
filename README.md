# grade-julia

A Docker image for grading exercises written in the [Julia programming
language][Julia] on the [A+ learning management system][A+], developed at Aalto
University. To build the container image, you must [install Docker], navigate
to this folder and run the `docker build` command ([docs][docker-build])

	docker build --tag organization/grade-julia:tag .

in the terminal emulator of your choice. Also see the [Docker Hub page][Docker Hub] for this
repository.

## Usage

To use this container on A+, you must add an exercise folder with the files

	exercise_name/
		config.yaml
		runtests.jl
		run.sh

to the course repository. Other files can also be included. The most important
thing to realize is that Julia files not starting with `test_` are included as
a part of `/exercise project` when the container is started, whereas the files
`runtests.jl` and `test_*.jl` are copied to the `/exercise_project/test/`
folder to be used in the tests. More on these below.

### config.yaml

This is the file you need to reference in the reStructeredText files of the
course area, if you wish to include a submittable exercise
([documentation][submit-docs]). A typical `config.yaml` file for this
container is structured as follows.

```yaml
---
title: Exercise title

description: |
    A description of this exercise, which is not shown anywhere.

instructions: |
    <p>
      Download the file specified above and fill in the missing code. Then
      upload it here and press <kbd>Submit</kbd> to have it graded by the
      system.
    </p>

view_type: access.types.stdasync.acceptFiles

files:

  - field: file1
    name: submission.jl

container:
  image: sesodesa/grade-julia:latest
  mount: exercises/exercise_name
  cmd: /exercise/run.sh

```

### run.sh

The job of this shell script is to run Julia in the container, so that the
tests are run on the submitted exercise. It should also copy the feedback
files generated by the grading script to the relevant folder in the container,
so that the grading wrapper can then post the feedback to the student.
Typical contents of this file are as follows:

```sh
## Start off by running the tests.
#
# The exercise_project folder on the grader contains a test_project.jl script,
# that copies files uploaded from this folder into correct locations, before
# running the Julia tests. The `capture` command runs the grading script with
# reduced privileges, so that the student submission cannot write anything to
# the /feedback folder.

capture pre julia test_project.jl

## Move feedback to correct location.
#
# Overwrite the /feedback directory with /exercise_project/feedback, generated
# by the grading script. The grading wrapper will then call `grade` to give
# the feedback to the student.

cp -rT /exercise_project/feedback /feedback

```

### runtests.jl

The exercise-specific tests are specified here as Julia code. This is the only
file a teacher should really need to modify for each exercise, if the above
files are in place. The file should contain at least the following lines:

```julia
using exercise
using ExerciseTests

# Generate grader with a certain number of maximum points (a whole number).
# Also initialize feedback string.

const MAX_POINTS = 5

let grader = Grader(MAX_POINTS)

	# Add title to the feedback window.

	add_hn(grader, "Feedback", 3)

	## TODO
	#
	# Write your test code here and give a student points and feedback using
	# the helper functions defined on the Grader type.

	# Write the feedback to the feedback files. These will then be copied to
	# the correct location by run.sh.

	write_feedback(grader)

end # let

```

You can also write other test-related files by prefixing them with `test_`.
These can then be included into the `runtests.jl` file with Julia's
[`include`][code-loading] function.

## License

See the [LICENSE](./LICENSE) file in this repository.

[Julia]: https://julialang.org/
[A+]: https://apluslms.github.io/
[install Docker]: https://docs.docker.com/get-docker/
[docker-build]: https://docs.docker.com/engine/reference/commandline/build/
[Docker Hub]: https://hub.docker.com/repository/docker/sesodesa/grade-julia
[submit-docs]: https://github.com/apluslms/a-plus-rst-tools/blob/master/README.md#4-submittable-exercise
[code-loading]: https://docs.julialang.org/en/v1/manual/code-loading/
